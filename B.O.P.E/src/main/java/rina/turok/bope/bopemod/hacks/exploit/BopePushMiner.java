package rina.turok.bope.bopemod.hacks.exploit;

import net.minecraft.network.play.client.CPacketPlayerDigging;
import net.minecraft.entity.player.EntityPlayer;
import net.minecraft.util.math.RayTraceResult;
import net.minecraft.entity.EntityLivingBase;
import net.minecraft.util.math.BlockPos;
import net.minecraft.util.EnumFacing;
import net.minecraft.util.EnumHand;

// Zero alpine manager.
import me.zero.alpine.listener.EventHandler;
import me.zero.alpine.listener.Listener;

// Modules.
import rina.turok.bope.bopemod.hacks.BopeCategory;

// Events.
import rina.turok.bope.bopemod.events.BopeEventPacket;

// Data.
import rina.turok.bope.bopemod.BopeMessage;
import rina.turok.bope.bopemod.BopeModule;

// Core.
import rina.turok.bope.Bope;

/**
* @author Rina
*
* Created by Rina.
* 17/05/2020.
*
*/
public class BopePushMiner extends BopeModule {
	boolean focus = false;

	public BopePushMiner() {
		super(BopeCategory.BOPE_EXPLOIT);

		// Info.
		this.name        = "Push Miner";
		this.tag         = "PushMiner";
		this.description = "You can break any block bypass.";

		// Release or launch the module.
		release("B.O.P.E - Module - B.O.P.E");
	}

	@Override
	public void update() {
		// First get the split BLOCK, bypass the entity.
		mc.world.loadedEntityList.stream()
			.filter(entity -> entity instanceof EntityLivingBase)
			.filter(entity -> mc.player == entity)
			.map(   entity -> (EntityLivingBase) entity)
			.filter(entity -> !(entity.isDead))
			.filter(entity -> (true && entity instanceof EntityPlayer))
			.forEach(this::process);

		// Create a result for get the mouse over.
		RayTraceResult normal_result = mc.objectMouseOver;

		if (normal_result != null) {
			// If equals any entity just make the focus on.
			if (normal_result.typeOfHit == RayTraceResult.Type.ENTITY) {
				focus = true;
			} else {
				// Else no, just set to false.
				focus = false;
			}
		}
	}

	private void process(EntityLivingBase event) {
		// Get the raytrace of bypass result.
		RayTraceResult bypass_entity_result = event.rayTrace(6, mc.getRenderPartialTicks());

		// If focus on.
		if (bypass_entity_result != null && focus) {
			if (bypass_entity_result.typeOfHit == RayTraceResult.Type.BLOCK) {
				BlockPos block_pos = bypass_entity_result.getBlockPos();

				// If click, start crash.
				if (mc.gameSettings.keyBindAttack.isKeyDown()) {
					// Start animation.
					mc.player.swingArm(EnumHand.MAIN_HAND);
					mc.player.connection.sendPacket(new CPacketPlayerDigging(CPacketPlayerDigging.Action.START_DESTROY_BLOCK, block_pos, EnumFacing.UP));
					mc.player.connection.sendPacket(new CPacketPlayerDigging(CPacketPlayerDigging.Action.STOP_DESTROY_BLOCK, block_pos, EnumFacing.UP));
				
					// Crash the block.
					mc.playerController.onPlayerDamageBlock(block_pos, EnumFacing.UP);
				}
			}
		}
	}
} 